<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FieldAgent - Dashboard</title>

    <script th:src="@{/Js/tailwind.jit.js}"></script>
    <link rel="stylesheet" th:href="@{/fontAwesome-free-6.6.0-web/css/all.min.css}">
    <style>
        /* Add a simple loading spinner style */
        .loader-sm {
            border: 3px solid #f3f4f6;
            border-radius: 50%;
            border-top: 3px solid #4f46e5;
            /* Indigo */
            width: 16px;
            height: 16px;
            animation: spin 1s linear infinite;
            display: inline-block;
            /* Make it inline */
            margin-left: 8px;
            /* Add some space */
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body class="bg-gray-100 min-h-screen pb-20"> <!-- Added padding-bottom -->
    <!-- Top Navigation -->
    <nav class="bg-white shadow-md px-4 py-3 sticky top-0 z-10">
        <div class="flex justify-between items-center">
            <div class="flex items-center">
                <button id="menuToggle" class="mr-4 text-gray-600 focus:outline-none" aria-label="Toggle menu">
                    <i class="fas fa-bars text-lg"></i>
                </button>
                <h1 class="text-xl font-bold text-indigo-600">FieldAgent</h1>
            </div>
            <div class="flex items-center space-x-4">
                <div class="relative">
                    <button id="notificationBtn" class="text-gray-600 focus:outline-none" aria-label="Notifications">
                        <i class="fas fa-bell text-lg"></i>
                        <span
                            class="absolute top-0 right-0 transform translate-x-1/2 -translate-y-1/2 bg-red-500 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center">0</span>
                        <!-- Default to 0 -->
                    </button>
                </div>
                <div class="h-8 w-8 rounded-full bg-indigo-200 flex items-center justify-center text-indigo-700 font-semibold cursor-pointer"
                    id="profileDropdown">
                    <span id="agentInitials">--</span> <!-- Placeholder -->
                </div>
            </div>
        </div>
    </nav>

    <!-- Sidebar Menu (Hidden by default on mobile) -->
    <div id="sidebar"
        class="fixed inset-y-0 left-0 bg-white w-64 shadow-lg transform -translate-x-full transition-transform duration-300 ease-in-out z-20">
        <div class="p-4 border-b">
            <div class="flex items-center">
                <div
                    class="h-10 w-10 rounded-full bg-indigo-200 flex items-center justify-center text-indigo-700 font-semibold mr-3">
                    <span id="sidebarAgentInitials">--</span> <!-- Placeholder -->
                </div>
                <div>
                    <h2 class="text-lg font-semibold" id="agentName">Loading...</h2>
                    <p class="text-sm text-gray-600" id="agentId">Agent ID: Loading...</p>
                </div>
            </div>
        </div>
        <nav class="mt-4">
            <a th:href="@{/agent/dashboard}"
                class="flex items-center px-4 py-3 text-indigo-600 bg-indigo-50 border-l-4 border-indigo-600">
                <i class="fas fa-th-large w-6"></i>
                <span>Dashboard</span>
            </a>
            <a th:href="@{/agent/activeRoute}" class="flex items-center px-4 py-3 text-gray-600 hover:bg-gray-100">
                <i class="fas fa-route w-6"></i>
                <span>Active Route</span>
            </a>
            <a th:href="@{/agent/customers}" class="flex items-center px-4 py-3 text-gray-600 hover:bg-gray-100">
                <i class="fas fa-users w-6"></i>
                <span>Customers</span>
            </a>
            <a th:href="@{/agent/collection}" class="flex items-center px-4 py-3 text-gray-600 hover:bg-gray-100">
                <i class="fas fa-money-bill-wave w-6"></i>
                <span>Collections</span>
            </a>
            <a th:href="@{/agent/history}" class="flex items-center px-4 py-3 text-gray-600 hover:bg-gray-100">
                <i class="fas fa-history w-6"></i>
                <span>History</span>
            </a>
            <a th:href="@{/agent/settings}" class="flex items-center px-4 py-3 text-gray-600 hover:bg-gray-100">
                <i class="fas fa-cog w-6"></i>
                <span>Settings</span>
            </a>
        </nav>
        <div class="absolute bottom-0 w-full border-t p-4">
            <button id="logoutBtn"
                class="w-full flex items-center justify-center px-4 py-2 text-red-600 hover:bg-red-50 rounded-lg">
                <i class="fas fa-sign-out-alt mr-2"></i>
                <span>Logout</span>
            </button>
        </div>
    </div>

    <!-- Overlay for sidebar -->
    <div id="overlay"
        class="fixed inset-0 bg-black opacity-0 pointer-events-none transition-opacity duration-300 ease-in-out z-10">
    </div>

    <!-- Main Content -->
    <div class="container mx-auto px-4 py-6">
        <!-- Welcome Section -->
        <div class="mb-6">
            <h2 class="text-2xl font-bold text-gray-800">Welcome back, <span id="welcomeName">Loading...</span>!</h2>
            <p class="text-gray-600">Today is <span id="currentDate"></span></p>
        </div>

        <!-- Alert Container -->
        <div id="alertContainer" class="mb-4"></div>

        <!-- Current Status Card -->
        <div class="bg-white rounded-xl shadow-md p-6 mb-6">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-gray-800">Current Status</h3>
                <span id="statusBadge"
                    class="px-3 py-1 text-sm rounded-full bg-gray-100 text-gray-800">Loading...</span>
            </div>
            <div id="statusContent"> <!-- Wrapper for status content -->
                <!-- Loading State -->
                <div id="statusLoading" class="text-center text-gray-500 py-4">
                    <div class="loader-sm" style="width: 24px; height: 24px; border-width: 4px; margin: 0 auto;"></div>
                    <p class="mt-2">Loading status...</p>
                </div>
                <!-- Inactive State -->
                <div id="startRouteCard" class="hidden">
                    <p class="text-gray-600 mb-4">You haven't started your route for today. Ready to begin?</p>
                    <button id="startRouteBtn"
                        class="w-full flex items-center justify-center py-3 px-4 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg shadow transition-colors duration-300">
                        <i class="fas fa-play-circle mr-2"></i>
                        <span>Start Route</span>
                    </button>
                </div>
                <!-- Active State -->
                <div id="activeRouteCard" class="hidden">
                    <div class="flex items-center text-green-600 mb-2">
                        <i class="fas fa-circle text-xs animate-pulse mr-2"></i>
                        <p class="font-medium">Route active for <span id="routeActiveTime">--h --m</span></p>
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 text-gray-600 text-sm mb-4">
                        <div>
                            <p class="font-medium text-gray-500">Started at:</p>
                            <p id="routeStartTime" class="font-semibold">--:-- --</p>
                        </div>
                        <div class="text-center sm:text-left">
                            <p class="font-medium text-gray-500">Customers visited:</p>
                            <p id="customersVisited" class="font-semibold">--/--</p>
                        </div>
                        <div class="text-right sm:text-left">
                            <p class="font-medium text-gray-500">Collections:</p>
                            <p id="totalCollected" class="font-semibold">$ --.--</p>
                        </div>
                    </div>
                    <div class="flex space-x-2">
                        <button id="viewRouteBtn"
                            class="flex-1 flex items-center justify-center py-2 px-4 bg-indigo-100 hover:bg-indigo-200 text-indigo-600 rounded-lg transition-colors duration-300">
                            <i class="fas fa-map-marked-alt mr-2"></i>
                            <span>View Route</span>
                        </button>
                        <button id="endRouteBtn"
                            class="flex-1 flex items-center justify-center py-2 px-4 bg-red-100 hover:bg-red-200 text-red-600 rounded-lg transition-colors duration-300">
                            <i class="fas fa-stop-circle mr-2"></i>
                            <span>End Route</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <h3 class="text-lg font-semibold text-gray-800 mb-3">Quick Actions</h3>
        <div class="grid grid-cols-2 gap-4 mb-6">
            <a th:href="@{/agent/visit}"
                class="bg-white rounded-xl shadow-sm p-4 flex flex-col items-center justify-center hover:shadow-md transition-shadow duration-300">
                <div class="h-12 w-12 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 mb-2">
                    <i class="fas fa-clipboard-check text-xl"></i>
                </div>
                <span class="text-gray-800 font-medium text-center">Record Visit</span>
            </a>
            <a th:href="@{/agent/collection}"
                class="bg-white rounded-xl shadow-sm p-4 flex flex-col items-center justify-center hover:shadow-md transition-shadow duration-300">
                <div class="h-12 w-12 rounded-full bg-green-100 flex items-center justify-center text-green-600 mb-2">
                    <i class="fas fa-hand-holding-usd text-xl"></i>
                </div>
                <span class="text-gray-800 font-medium text-center">Record Collection</span>
            </a>
        </div>

        <!-- Today's Schedule -->
        <h3 class="text-lg font-semibold text-gray-800 mb-3">Today's Schedule</h3>
        <div class="bg-white rounded-xl shadow-md overflow-hidden mb-6">
            <div class="p-4 border-b flex justify-between items-center">
                <h4 class="font-medium">Upcoming Visits</h4>
                <a th:href="@{/agent/schedule}" class="text-sm text-indigo-600">View All</a>
            </div>
            <div id="scheduleList" class="divide-y">
                <!-- Loading State -->
                <div id="scheduleLoading" class="p-4 text-center text-gray-500">
                    <div class="loader-sm" style="width: 20px; height: 20px; border-width: 3px; margin: 0 auto;"></div>
                    <p class="mt-2">Loading schedule...</p>
                </div>
                <!-- Empty State -->
                <div id="scheduleEmpty" class="hidden p-4 text-center text-gray-500">
                    No visits scheduled for today.
                </div>
                <!-- Schedule items will be populated here -->
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <nav class="fixed bottom-0 inset-x-0 bg-white border-t shadow-lg z-10 md:hidden">
        <!-- Hide on medium screens and up -->
        <div class="flex justify-around">
            <a th:href="@{/agent/dashboard}"
                class="flex flex-col items-center py-2 flex-1 text-indigo-600 border-t-2 border-indigo-600">
                <i class="fas fa-th-large text-lg"></i>
                <span class="text-xs mt-1">Dashboard</span>
            </a>
            <a th:href="@{/agent/activeRoute}" class="flex flex-col items-center py-2 flex-1 text-gray-500">
                <i class="fas fa-route text-lg"></i>
                <span class="text-xs mt-1">Route</span>
            </a>
            <a th:href="@{/agent/visit}" class="flex flex-col items-center py-2 flex-1 text-gray-500">
                <i class="fas fa-clipboard-check text-lg"></i>
                <span class="text-xs mt-1">Visit</span>
            </a>
            <a th:href="@{/agent/collection}" class="flex flex-col items-center py-2 flex-1 text-gray-500">
                <i class="fas fa-hand-holding-usd text-lg"></i>
                <span class="text-xs mt-1">Collect</span>
            </a>
            <a th:href="@{/agent/more}" class="flex flex-col items-center py-2 flex-1 text-gray-500">
                <i class="fas fa-ellipsis-h text-lg"></i>
                <span class="text-xs mt-1">More</span>
            </a>
        </div>
    </nav>

    <script>
        // Utility function to get JWT token from cookie or localStorage
        function getJwtToken() {
            // Prefer cookie if available
            const cookieValue = document.cookie
                .split('; ')
                .find(row => row.startsWith('jwt_token='))
                ?.split('=')[1];
            if (cookieValue) return cookieValue;

            // Fallback to localStorage
            return localStorage.getItem('jwt_token');
        }

        // Utility function to make authenticated fetch requests
        async function fetchAuthenticated(url, options = {}) {
            const token = getJwtToken();
            if (!token) {
                console.error("No JWT token found. Redirecting to login.");
                // Optionally redirect to login if no token is found anywhere
                // window.location.href = '/agent/login';
                throw new Error("Authentication token not found.");
            }

            const headers = {
                ...options.headers,
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json',
                'Accept': 'application/json'
            };

            try {
                const response = await fetch(url, { ...options, headers });
                if (response.status === 401 || response.status === 403) {
                    // Unauthorized or Forbidden
                    console.error("Authentication error:", response.status);
                    // Clear potentially invalid token and redirect
                    localStorage.removeItem('jwt_token');
                    localStorage.removeItem('isLoggedIn');
                    document.cookie = "jwt_token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"; // Clear cookie
                    window.location.href = '/agent/login';
                    throw new Error("Authentication failed.");
                }
                if (!response.ok) {
                    // Handle other errors (like 500 Internal Server Error)
                    const errorData = await response.text(); // Try to get error text
                    console.error(`HTTP error! status: ${response.status}, message: ${errorData}`);
                    throw new Error(`Failed to fetch ${url}. Status: ${response.status}`);
                }
                return response.json(); // Assume response is JSON
            } catch (error) {
                console.error("Fetch error:", error);
                // Re-throw the error to be caught by the calling function
                throw error;
            }
        }

        // Function to show alert messages (reuse from login)
        function showAlert(message, type = 'error', duration = 5000) {
            const alertContainer = document.getElementById('alertContainer');
            // Remove any existing alerts of the same type to avoid spamming
            const existingAlert = alertContainer.querySelector(`.alert-${type}`);
            if (existingAlert) existingAlert.remove();

            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} mb-2`; // Add margin-bottom

            alertDiv.innerHTML = `
                <div class="alert-content flex items-center p-4 rounded-md shadow-md text-sm font-medium
                            ${type === 'error' ? 'bg-red-100 border border-red-300 text-red-700' :
                    type === 'success' ? 'bg-green-100 border border-green-300 text-green-700' :
                        'bg-blue-100 border border-blue-300 text-blue-700'}">
                    <i class="fas ${type === 'error' ? 'fa-exclamation-circle' : type === 'success' ? 'fa-check-circle' : 'fa-info-circle'} mr-2"></i>
                    <span>${message}</span>
                    <button class="ml-auto text-current opacity-75 hover:opacity-100" onclick="this.parentElement.parentElement.remove()">
                       <i class="fas fa-times"></i>
                    </button>
                </div>
            `;

            alertContainer.appendChild(alertDiv);

            // Auto-remove after duration (if duration is positive)
            if (duration > 0) {
                setTimeout(() => {
                    alertDiv.style.opacity = '0';
                    alertDiv.style.transition = 'opacity 0.3s ease-out';
                    setTimeout(() => alertDiv.remove(), 300);
                }, duration);
            }
        }


        document.addEventListener('DOMContentLoaded', async function () {
            const token = getJwtToken();
            if (!token) {
                window.location.href = '/agent/login';
                return; // Stop execution if no token
            }

            // Set current date
            const now = new Date();
            const dateOptions = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('currentDate').textContent = now.toLocaleDateString('en-US', dateOptions);

            // Sidebar toggle logic (keep as is)
            const menuToggle = document.getElementById('menuToggle');
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');

            menuToggle.addEventListener('click', function () {
                sidebar.classList.toggle('-translate-x-full');
                overlay.classList.toggle('opacity-0');
                overlay.classList.toggle('pointer-events-none');
            });

            overlay.addEventListener('click', function () {
                sidebar.classList.add('-translate-x-full');
                overlay.classList.add('opacity-0');
                overlay.classList.add('pointer-events-none');
            });

            // Logout button logic
            const logoutBtn = document.getElementById('logoutBtn');
            logoutBtn.addEventListener('click', function () {
                if (confirm('Are you sure you want to logout?')) {
                    localStorage.removeItem('jwt_token');
                    localStorage.removeItem('isLoggedIn');
                    document.cookie = "jwt_token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"; // Clear cookie
                    window.location.href = '/agent/login';
                }
            });

            // --- Fetch Data ---
            try {
                // Use Promise.all to fetch data concurrently
                const [profileData, statusData, scheduleData] = await Promise.all([
                    fetchAuthenticated('/api/agent/profile'),
                    fetchAuthenticated('/api/agent/status'),
                    fetchAuthenticated('/api/agent/schedule/today')
                ]);

                // Populate profile data
                populateProfile(profileData);

                // Populate status data
                populateStatus(statusData);

                // Populate schedule data
                populateSchedule(scheduleData);

            } catch (error) {
                console.error("Failed to load dashboard data:", error);
                showAlert("Failed to load dashboard data. Please try refreshing.", "error", 0); // Show persistent error
            }

            // --- UI Update Functions ---
            function populateProfile(data) {
                if (!data) return;
                const agentName = data.username || 'Agent'; // Use username from profile data
                const agentId = data.agentId || 'N/A';
                const firstName = agentName.split(' ')[0];
                const initials = agentName.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);

                document.getElementById('welcomeName').textContent = firstName;
                document.getElementById('agentName').textContent = agentName;
                document.getElementById('agentId').textContent = `Agent ID: ${agentId}`;
                document.getElementById('agentInitials').textContent = initials;
                document.getElementById('sidebarAgentInitials').textContent = initials;
            }

            let routeTimerInterval = null; // Keep track of the timer

            function populateStatus(data) {
                const statusBadge = document.getElementById('statusBadge');
                const startRouteCard = document.getElementById('startRouteCard');
                const activeRouteCard = document.getElementById('activeRouteCard');
                const statusLoading = document.getElementById('statusLoading');

                statusLoading.classList.add('hidden'); // Hide loading indicator

                if (!data) {
                    statusBadge.textContent = 'Error';
                    statusBadge.className = 'px-3 py-1 text-sm rounded-full bg-red-100 text-red-800';
                    showAlert("Could not load route status.", "error");
                    return;
                }

                if (data.isActive) {
                    // --- Active Route ---
                    startRouteCard.classList.add('hidden');
                    activeRouteCard.classList.remove('hidden');
                    statusBadge.textContent = 'Active';
                    statusBadge.className = 'px-3 py-1 text-sm rounded-full bg-green-100 text-green-800';

                    const startTime = new Date(data.startTime);
                    document.getElementById('routeStartTime').textContent = startTime.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
                    document.getElementById('customersVisited').textContent = `${data.customersVisited || 0}/${data.totalCustomers || '--'}`;
                    document.getElementById('totalCollected').textContent = `$${(data.totalCollected || 0).toFixed(2)}`;

                    startRouteTimer(startTime); // Start or update the timer

                    // Add event listeners for active route buttons
                    document.getElementById('viewRouteBtn').addEventListener('click', () => window.location.href = '/agent/activeRoute');
                    document.getElementById('endRouteBtn').addEventListener('click', handleEndRoute);

                } else {
                    // --- Inactive Route ---
                    activeRouteCard.classList.add('hidden');
                    startRouteCard.classList.remove('hidden');
                    statusBadge.textContent = 'Inactive';
                    statusBadge.className = 'px-3 py-1 text-sm rounded-full bg-gray-100 text-gray-800';

                    // Stop timer if it's running
                    if (routeTimerInterval) {
                        clearInterval(routeTimerInterval);
                        routeTimerInterval = null;
                    }

                    // Add event listener for start route button
                    document.getElementById('startRouteBtn').addEventListener('click', handleStartRoute);
                }
            }

            function populateSchedule(data) {
                const scheduleList = document.getElementById('scheduleList');
                const scheduleLoading = document.getElementById('scheduleLoading');
                const scheduleEmpty = document.getElementById('scheduleEmpty');

                scheduleLoading.classList.add('hidden'); // Hide loading indicator
                scheduleList.innerHTML = ''; // Clear previous items (except loading/empty)

                if (!data || data.length === 0) {
                    scheduleEmpty.classList.remove('hidden');
                    return;
                }

                scheduleEmpty.classList.add('hidden'); // Hide empty state

                data.forEach(visit => {
                    const visitElement = document.createElement('div');
                    visitElement.className = 'p-4 hover:bg-gray-50 transition-colors duration-200';
                    visitElement.innerHTML = `
                        <div class="flex justify-between items-start">
                            <div>
                                <h5 class="font-medium">${visit.customerName || 'N/A'}</h5>
                                <p class="text-sm text-gray-600">${visit.address || 'No address'}</p>
                            </div>
                            <span class="text-sm bg-indigo-100 text-indigo-800 px-2 py-1 rounded whitespace-nowrap">${visit.time || '--:--'}</span>
                        </div>
                        <div class="mt-2 flex justify-between items-center">
                            <span class="text-sm text-gray-500">
                                ${visit.collectionDue ? `Collection Due: $${visit.collectionDue.toFixed(2)}` : 'No collection'}
                            </span>
                            <div class="flex space-x-2">
                                <button class="text-sm text-indigo-600 hover:text-indigo-800" aria-label="Get directions for ${visit.customerName || ''}" title="Get Directions">
                                    <i class="fas fa-directions"></i>
                                </button>
                                <button class="text-sm text-indigo-600 hover:text-indigo-800" aria-label="Call ${visit.customerName || ''}" title="Call Customer">
                                    <i class="fas fa-phone"></i>
                                </button>
                            </div>
                        </div>
                    `;
                    scheduleList.appendChild(visitElement);
                });
            }

            // --- Route Actions ---
            async function handleStartRoute() {
                const startButton = document.getElementById('startRouteBtn');
                startButton.disabled = true;
                startButton.innerHTML = `<div class="loader-sm" style="width:16px; height:16px; border-color: white; border-top-color: transparent; margin: 0 auto;"></div>`;

                try {
                    // Assuming you have a POST endpoint to start the route
                    const statusData = await fetchAuthenticated('/api/agent/route/start', { method: 'POST' });
                    populateStatus(statusData); // Update UI with new status
                    showAlert("Route started successfully!", "success");
                } catch (error) {
                    console.error("Failed to start route:", error);
                    showAlert("Failed to start route. Please try again.", "error");
                } finally {
                    // Reset button state (populateStatus should re-add the correct button/state)
                    startButton.disabled = false;
                    // The button itself should be removed/hidden by populateStatus if successful
                }
            }

            async function handleEndRoute() {
                if (!confirm('Are you sure you want to end your route for today?')) return;

                const endButton = document.getElementById('endRouteBtn');
                const viewButton = document.getElementById('viewRouteBtn');
                endButton.disabled = true;
                viewButton.disabled = true;
                endButton.innerHTML = `<div class="loader-sm" style="width:16px; height:16px; border-color: #dc2626; border-top-color: transparent; margin: 0 auto;"></div>`;

                try {
                    // Assuming you have a POST endpoint to end the route
                    const statusData = await fetchAuthenticated('/api/agent/route/end', { method: 'POST' });
                    populateStatus(statusData); // Update UI to inactive state
                    showAlert("Route ended successfully!", "success");
                    // Optionally redirect to a summary page
                    // window.location.href = '/agent/routeSummary';
                } catch (error) {
                    console.error("Failed to end route:", error);
                    showAlert("Failed to end route. Please try again.", "error");
                    // Re-enable buttons on error
                    endButton.disabled = false;
                    viewButton.disabled = false;
                    endButton.innerHTML = '<i class="fas fa-stop-circle mr-2"></i><span>End Route</span>';
                }
            }


            // --- Route Timer Logic ---
            function startRouteTimer(startTime) {
                if (routeTimerInterval) {
                    clearInterval(routeTimerInterval); // Clear existing timer
                }

                const routeActiveTimeElement = document.getElementById('routeActiveTime');
                if (!routeActiveTimeElement) return; // Element might not be visible

                const updateTimer = () => {
                    const now = new Date();
                    const diffMs = now - startTime;
                    if (diffMs < 0) { // Avoid negative time if clock is skewed
                        routeActiveTimeElement.textContent = `0h 0m`;
                        return;
                    }
                    const diffHrs = Math.floor(diffMs / (1000 * 60 * 60));
                    const diffMins = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));
                    routeActiveTimeElement.textContent = `${diffHrs}h ${diffMins}m`;
                };

                updateTimer(); // Initial update
                routeTimerInterval = setInterval(updateTimer, 60000); // Update every minute
            }

        });
    </script>
</body>

</html>